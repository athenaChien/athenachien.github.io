<div class="card-columns m-3 mt-5">
  {% assign colname = include.collection | default: "projects" %}
  {% assign all     = site[colname] %}

  {% comment %}
    Derive a sort key from `year`:
    - take text before a dash (handles "2023 - current")
    - then take the last token (handles "Fall 2024")
  {% endcomment %}
  {% assign groups = all | group_by_exp: "it", "it.year | default: '' | split: '-' | first | strip | split: ' ' | last" %}
  {% assign groups = groups | sort: "name" | reverse %}

  {% for g in groups %}
    {% for item in g.items %}
      {% assign project_type  = "local" %}
      {% assign project_id    = item.name  | default: item.title | default: item.basename | slugify %}
      {% assign project_img   = item.image %}
      {% assign project_name  = item.name  | default: item.title | default: item.basename %}
      {% assign project_desc  = item.description %}
      {% assign project_role  = item.role %}
      {% assign project_year  = item.year %}  
      {% assign project_team  = item.team %}
      {% assign project_pi    = item.pi %}
      {% assign project_tools = item.tools %}

      {% if item.link %}
        {% assign project_url = item.link %}{% assign external = true %}
      {% elsif item.external_url %}
        {% assign project_url = item.external_url %}{% assign external = true %}
      {% else %}
        {% assign project_url = nil %}{% assign external = false %}
      {% endif %}

      {% include projects/project-card.html %}
    {% endfor %}
  {% endfor %}
</div>
